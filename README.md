# cnf-geodes
Simulation, analysis, and visualization pipeline for "Implications of symmetry and pressure in Friedmann cosmology. III. The black hole mass function"

## Overview

This is a set of small analysis tools, which grew organically during the development of Paper III.  I have attempted to be as Pythonic as possible, especially when writing in bash ;)  But seriously, please be forgiving with respect to inefficiencies in the implementation.  I have also attempted to carve out all vestigial code, but may have missed things here or there.  In particular, `units.py` contains lots of stuff that is duplicated elsewhere (but everything should be consistent).

The tools split into three categories:
1. Computation: e.g. a model GEODE theoretical mass function, a detector sensitivity cut
2. Solving the Keplerian orbital dynamics of binary systems, possibly with GEODEs
3. Auxiliary scripts which process outputs from 1.) and 2.) into the visualizations present in Paper III

Most tools are written in the UNIX style: they accept line based input on STDIN and produce line based output on STDOUT, complaining to STDERR.

## Requisite Tools

I developed on a Devuan ASCII 2.0 system, with Python 3.5.3.  To make the visualizations using the included scripts, you will need:

+ Python with Scipy/numpy
+ gnuplot 5.0 (or greater)
+ pdfcrop
+ Standard UNIX tools (e.g. sed, tail, cut, grep)
+ LaTeX (pdflatex)

## Data Sources

Various data have been included in this git repository, for your convenience.
+ We have included in `data/` merger chirps, redshifts, and individual BH masses, all with 90% confidences, from [GWTC-1](https://arxiv.org/abs/1811.12907)
+ We have included in `demink_belczynski_N/` the BH-BH, BH-NS, and NS-NS data sets at solar metallicity.  These are the chief data sets of interest in the analysis of Paper III.  More data sets can be found at [Double Compact Objects](https://www.syntheticuniverse.org/dco_initial.php), and their production is detailed in [de Mink & Belczynski (2015)](http://adsabs.harvard.edu/abs/2015arXiv150603573D).  Note that their files are spread across directories and are most easily grabbed using `wget`.

## Data Products

Data products are not included in the repo, but are instead generated by the user using the included scripts and accompanying files detailed in Data Sources.  All our data products are space-delimited ASCII tables to double precision.  Where not obvious, the format and contents of the tables are given as a comment in the table headers.  Units for the main data outputs are

+ **Mass**: Solar mass
+ **Distance**: AU

Note that our distance unit differs from the Solar radius unit used by de Mink & Belczynski!

## Usage

First, note that the main scripts, `./geode-belczynski.py` and `./odb_analysis_revisited.py`, can be run standalone and give usage syntax when run without parameters.

To regenerate the predicted mass function and its visualization, you can 
```bash
$ make init
$ make
```
To generate the GEODE population histograms and heatmaps, you must first make evolved population data products.  For example, to run the NS-NS initial conditions as N=2 GEODE binaries, with sampling in redshift based on the Madau & Dickinson (2014) SFR, you would type:
```bash
$ cat demink_belczynski_N/ANSNS.02.dat | ./geode-belczynski.py results/ANSNS_geodegeode geode-geode madau > /dev/null & 
$ tail -f current_status
```
Note that `geode-belczynski.py` is an exception in its usage of STDOUT, because the `lsoda` integrator of Scipy drives ancient FORTRAN, which vomits on STDOUT.  Progress will be written to a file current_status, which is set internally.  (Yes, I know this is awkward for parallel runs, but really this output is debug and I didn't care about it once things were solid.)

You can then build figures with
```bash
$ ./build_core_figures.sh
```
These scripts expect that files in `results/` have names `A{NSNS | BHBH | BHNS}_{geodegeode geodens control}`.  There is flexibility with the these tags, which can be adjusted in the main loops of `build_core_figures.sh`.   Any tags that combine to produce a filename absent in `results/` are skipped.  The histograms will not have control populations unless there is something with `A{*}_control` sitting in `results/`.  

Be advised, if you run control populations (i.e. as bh-bh), you will get slightly higher merge rates than suggested by the merge times (Myr!!) Column 7 in the de Mink & Belczynski sets.  This is because de Mink & Belczynski follow the entire merger, whereas we cut at periastron 10<sup>-2</sup> AU.  This effect produces a 0.7% to 1.9% increase in merger rate, where the upper bound comes from the BH-BH systems.  The effect is larger in these systems because their orbital frequencies are lower, so they radiate less.